<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CareHome{% endblock %}</title>
    <!-- Favicon -->
    {% load static %}
    <link rel="icon" href="{% static 'images/favicon/favicon.ico' %}" type="image/x-icon">
    <link rel="shortcut icon" href="{% static 'images/favicon/favicon.ico' %}" type="image/x-icon">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/site-nav.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body class="d-flex">
    <!-- Mobile header -->
    <div class="mobile-header">
        <button class="navbar-toggler" type="button" id="sidebarToggle">
            <i class="bi bi-list"></i>
        </button>
        <span class="ms-2">CareHome</span>
    </div>

    <!-- Sidebar overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <nav class="d-md-block bg-dark sidebar flex-shrink-0" id="sidebar">
        <div class="position-sticky p-2">
            <!-- Logo space -->
            <div class="navbar-brand text-white mb-4">
                <a class="navbar-brand text-white" href="{% url 'home:home' %}">
                    <div class="d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 43 43" fill="none" class="me-2">
                            <path d="M21.1102 21.9943C18.7215 16.7135 10.3608 17.276 10.3608 24.0255C10.3608 30.775 21.1102 36.3997 21.1102 36.3997C21.1102 36.3997 31.8596 30.775 31.8596 24.0255C31.8596 17.276 23.499 16.7135 21.1102 21.9943Z" fill="#FF8EBF"/>
                            <path d="M2.00024 20.2285V32.7353C2.00024 35.3548 2.00024 36.6655 2.52096 37.6661C2.979 38.5461 3.70933 39.261 4.60827 39.7094C5.62924 40.2187 6.96644 40.2187 9.63686 40.2187H32.5836C35.254 40.2187 36.5893 40.2187 37.6103 39.7094C38.5092 39.261 39.242 38.5461 39.7 37.6661C40.2202 36.6665 40.2202 35.3579 40.2202 32.7435V20.2285C40.2202 18.9789 40.2191 18.3537 40.064 17.7722C39.9264 17.2569 39.7006 16.7693 39.3951 16.3286C39.0503 15.8314 38.5709 15.419 37.6104 14.5961L26.1443 4.77387C24.3609 3.24608 23.4692 2.48257 22.4656 2.19202C21.5813 1.93599 20.6387 1.93599 19.7544 2.19202C18.7516 2.48235 17.8612 3.24514 16.0804 4.77063L4.61061 14.5961C3.65001 15.419 3.17083 15.8314 2.82604 16.3286C2.5205 16.7693 2.29298 17.2569 2.15544 17.7722C2.00024 18.3537 2.00024 18.9788 2.00024 20.2285Z" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    <span class="fs-4 fw-semibold">CareHome</span>
                    </div>
                </a>
            </div>
            
            <ul class="list-unstyled">
                <!-- Home Section -->
                <li class="mb-1">
                    <a href="{% url 'home:home' %}" class="btn btn-toggle d-inline-flex align-items-center rounded border-0">
                        <i class="bi bi-house-fill me-2"></i><span>{{ STRINGS.NAV_HOME }}</span>
                    </a>
                </li>
                
                <!-- Registro Section -->
                <li class="mb-1">
                    <a href="{% url 'registry:registry_list' %}" class="btn btn-toggle d-inline-flex align-items-center rounded border-0">
                        <i class="bi bi-people-fill me-2"></i><span>{{ STRINGS.NAV_REGISTER }}</span>
                    </a>
                </li>
                
                <!-- Gestión Section -->
                {% if perms.management.view_worker or perms.management.view_resident %}
                <li class="mb-1">
                    <button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-toggle="collapse" data-bs-target="#orders-collapse" aria-expanded="false">
                        <i class="bi bi-gear-fill me-2"></i><span>{{ STRINGS.NAV_MANAGEMENT }}</span>
                    </button>
                    <div class="collapse" id="orders-collapse">
                        <ul class="btn-toggle-nav list-unstyled fw-normal pb-1">
                            {% if perms.management.view_worker %}
                            <li><a href="{% url 'management:workers_list' %}" class="d-inline-flex text-decoration-none rounded small">{{ STRINGS.NAV_WORKERS }}</a></li>
                            {% endif %}
                            {% if perms.management.view_resident %}
                            <li><a href="{% url 'management:residents_list' %}" class="d-inline-flex text-decoration-none rounded small">{{ STRINGS.NAV_RESIDENTS }}</a></li>
                            {% endif %}
                        </ul>
                    </div>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>
    
    <!-- Main content -->
    <main class="main-content px-md-4">
        <!-- User info header -->
        {% if user.is_authenticated %}
        <div class="d-flex justify-content-end align-items-center py-2 px-3 border-bottom mb-3">
            <div class="dropdown">
                <button class="btn btn-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-person-circle me-1"></i>
                    {% if user.worker_profile %}
                        {{ user.worker_profile.get_full_name }}
                    {% else %}
                        {{ user.username }}
                    {% endif %}
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="{% url 'accounts:profile' %}"><i class="bi bi-person me-2"></i>Mi perfil</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="{% url 'accounts:logout' %}"><i class="bi bi-box-arrow-right me-2"></i>Cerrar sesión</a></li>
                </ul>
            </div>
        </div>
        {% endif %}
        
        <!-- Contenedor para mensajes Flash (alertas Bootstrap) -->
        <div id="flash-messages-container" class="container my-2"></div>

        {% block content %}
        {% endblock %}
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Sidebar toggle JS -->
    <script src="{% static 'js/sidebar-toggle.js' %}"></script>
    <!-- Alert helper JS -->
    <script src="{% static 'js/alerts.js' %}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>